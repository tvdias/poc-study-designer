/**
 * @file        025-QuestionorAnswerNameValidation.js
 * @description Will validate Question / Answer name format on form
 *
 * @date        2025-06-12
 * @version     1.0
 *
 * @usage       This script is invoked on load and save of the Main form of required entity
 * @notes       
 */
function validateQuestionorAnswerNameFieldFormat(executionContext) {
    var formContext = executionContext.getFormContext();
    var control = executionContext.getEventSource(); // The control that triggered the event
    var fieldName = control.getName();
    var attribute = formContext.getAttribute(fieldName);
    var controlElement = formContext.getControl(fieldName); // For showing error

    if (!attribute || !controlElement) return;

    var value = attribute.getValue();
    if (!value) {
        controlElement.setNotification("This field is required.");
        return;
    }

    // Convert to uppercase
    let cleaned = value.toUpperCase();

    // Replace spaces with underscores
    cleaned = cleaned.replace(/\s+/g, "_");

    // Remove all characters except A-Z, 0–9, and underscores
    cleaned = cleaned.replace(/[^A-Z0-9_]/g, "");

    // Set back cleaned value if changed
    if (cleaned !== value) {
        attribute.setValue(cleaned);
    }

    // Length validation
    if (cleaned.length < 2 || cleaned.length > 20) {
        controlElement.setNotification("Must be between 2 and 20 characters.");
        return;
    }

    // Must start with a letter
    if (!/^[A-Z]/.test(cleaned)) {
        controlElement.setNotification("Must start with a letter (A–Z).");
        return;
    }

    // Clear existing errors
    controlElement.clearNotification();
}
