function filterSubsetDefinitionsGrid(executionContext) {
    var formContext = executionContext.getFormContext();
    var studyId = formContext.data.entity.getId();

    if (!studyId) return;

    studyId = studyId.replace(/[{}]/g, "");

    Xrm.WebApi.retrieveRecord(
        "kt_study",
        studyId,
        "?$select=_ktr_masterstudy_value"
    ).then(
        function (result) {

            if (!result._ktr_masterstudy_value) {
                console.warn("Lookup value is empty");
            }

            var gridControl = formContext.getControl("Subgrid_new_7");
            if (!gridControl) return;

            var effectiveStudyId =
                result._ktr_masterstudy_value
                    ? result._ktr_masterstudy_value
                    : studyId;

            var fetchXml =
                `<fetch>
                <entity name="ktr_subsetdefinition">
                    <filter type="and">
                        <condition attribute="ktr_masterstudyid"
                                   operator="eq"
                                   value="${effectiveStudyId}" />
                    </filter>
                </entity>
            </fetch>`;

            gridControl.setFilterXml(fetchXml);
            gridControl.refresh();
        },
        function (error) {
            console.error(error.message);
        }
    );
}
