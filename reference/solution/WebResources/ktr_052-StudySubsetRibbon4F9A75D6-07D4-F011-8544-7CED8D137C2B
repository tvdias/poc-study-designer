// web resource: new_/RibbonRules.HideSubgridButtons.js

// Purpose: CustomRule used in an EnableRule for a ribbon button.

// Return: true => button enabled/visible, false => button disabled (grayed out).

// Usage in Ribbon Workbench:

//  - Add a CustomRule under the Command's EnableRules

//  - Set Library to this web resource

//  - Function Name: shouldEnableButtonForThisSubgrid

//  - Add a CrmParameter of type PrimaryControl (so the function receives the form context)

var HideSubgridButtons = (function () {

    "use strict";

    /**

     * Called by Ribbon Workbench as a CustomRule (EnableRule).

     * primaryControl: the form's context (PrimaryControl) passed by the ribbon engine.

     * Return true => enable (show) button. Return false => disable (hide/disable) button.

     */

    function shouldEnableButtonForThisSubgrid(primaryControl) {

        try {

            var formContext = primaryControl;

            // If no formContext available (unexpected), do not hide the button

            if (!formContext || typeof formContext.getControl !== "function") {

                return true;

            }

            // List the subgrid CONTROL NAMES (NOT the entity logical name) for which

            // you want the button to be disabled on this specific form.

            // Put the exact control names as they appear in the form editor.

            var targetSubgridControlNames = [

                // Example: "Contacts_Subgrid", "my_customgrid_controlname"

                "Subgrid_new_7"

            ];

            // Normalize name comparer helper

            var normalize = function (s) {

                return (s || "").toString().toLowerCase();

            };

            // If any of the configured controls are present on the current form,

            // then disable the button (return false).

            for (var i = 0; i < targetSubgridControlNames.length; i++) {

                var ctrlName = targetSubgridControlNames[i];

                if (!ctrlName) continue;

                try {

                    var ctrl = formContext.getControl(ctrlName);

                    if (ctrl) {

                        // Found the specific subgrid control on this form -> disable button

                        return false;

                    }

                } catch (e) {

                    // ignore and continue

                }

            }

            // If none of the target controls exist on this form -> enable the button

            return true;

        } catch (err) {

            // On error, be safe and show the button

            return true;

        }

    }

    // expose function for ribbon

    return {

        shouldEnableButtonForThisSubgrid: shouldEnableButtonForThisSubgrid

    };

})();