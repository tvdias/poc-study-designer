/* Root container */
.matrix-control-root {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  height: 100%;
  width: 100%;
  box-sizing: border-box;
}

/* Scrollbar styling for better UX */
.matrix-control-root *::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

.matrix-control-root *::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 4px;
}

.matrix-control-root *::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 4px;
}

.matrix-control-root *::-webkit-scrollbar-thumb:hover {
  background: #a8a8a8;
}

/* Firefox scrollbar styling */
.matrix-control-root * {
  scrollbar-width: thin;
  scrollbar-color: #c1c1c1 #f1f1f1;
}

/* Ensure table cells don't wrap */
.matrix-table-cell {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ===== CRITICAL FIXES FOR STICKY POSITIONING ===== */

/* CSS Custom Properties for consistent spacing and positioning */
:root {
  --matrix-first-column-width: 200px;
  --matrix-bulk-column-width: 60px;
  --matrix-checkbox-column-width: 120px;
  
  /* Enhanced colors for better contrast and visibility */
  --matrix-sticky-bg: rgba(255, 255, 255, 0.98);
  --matrix-sticky-bg-hover: rgba(245, 245, 245, 0.98);
  --matrix-header-bg: rgba(250, 250, 250, 0.98);
  --matrix-border-color: #e1e1e1;
}

/* ENHANCED: Sticky positioning support with fixes for transparency and borders */
.sticky-header {
  position: -webkit-sticky !important;
  position: sticky !important;
  top: 0 !important;
  z-index: 10 !important;
  background-color: var(--matrix-header-bg) !important;
  backdrop-filter: blur(8px) !important;
  -webkit-backdrop-filter: blur(8px) !important;
}

.sticky-row-header {
  position: -webkit-sticky !important;
  position: sticky !important;
  left: 0 !important;
  z-index: 5 !important;
  background-color: var(--matrix-sticky-bg) !important;
  backdrop-filter: blur(8px) !important;
  -webkit-backdrop-filter: blur(8px) !important;
}

/* CRITICAL FIX: Enhanced Fluent UI Table overrides for sticky positioning */
.matrix-control-root .fui-Table {
  position: relative !important;
  border-collapse: separate !important;
  border-spacing: 0 !important;
}

/* CRITICAL FIX: First column (Studies) - solid background, no unwanted borders */
.matrix-control-root .fui-Table .fui-TableHeaderCell:first-child,
.matrix-control-root .fui-Table .fui-TableCell:first-child {
  position: sticky !important;
  left: 0 !important;
  background-color: var(--matrix-sticky-bg) !important;
  z-index: 3 !important;
  
  /* FIXED: Remove unwanted right border */
  border-right: none !important;
  
  /* Enhanced visual separation without borders */
  backdrop-filter: blur(8px) !important;
  -webkit-backdrop-filter: blur(8px) !important;
  box-shadow: 2px 0 4px rgba(0, 0, 0, 0.1) !important;
  
  /* Ensure content doesn't wrap */
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
  
  /* Fixed width management */
  min-width: var(--matrix-first-column-width) !important;
  width: var(--matrix-first-column-width) !important;
}

/* CRITICAL FIX: Second column (Bulk selection) - sticky positioning and solid background */
.matrix-control-root .fui-Table .fui-TableHeaderCell:nth-child(2),
.matrix-control-root .fui-Table .fui-TableCell:nth-child(2) {
  position: sticky !important;
  left: var(--matrix-first-column-width) !important;
  background-color: var(--matrix-sticky-bg) !important;
  z-index: 2 !important;
  
  /* FIXED: Remove unwanted borders */
  border-right: none !important;
  border-left: none !important;
  
  /* Enhanced visual separation without borders */
  backdrop-filter: blur(8px) !important;
  -webkit-backdrop-filter: blur(8px) !important;
  box-shadow: 2px 0 4px rgba(0, 0, 0, 0.1) !important;
  
  /* Fixed width management */
  min-width: var(--matrix-bulk-column-width) !important;
  width: var(--matrix-bulk-column-width) !important;
}

/* Enhanced header row specific styling */
.matrix-control-root .fui-Table .fui-TableHeader .fui-TableHeaderCell {
  background-color: var(--matrix-header-bg) !important;
  border-bottom: 1px solid var(--matrix-border-color) !important;
  font-weight: 600 !important;
}

/* Enhanced hover states for sticky columns with solid backgrounds */
.matrix-control-root .fui-Table .fui-TableRow:hover .fui-TableCell:first-child,
.matrix-control-root .fui-Table .fui-TableRow:hover .fui-TableCell:nth-child(2) {
  background-color: var(--matrix-sticky-bg-hover) !important;
}

/* Header hover states */
.matrix-control-root .fui-Table .fui-TableHeaderCell:hover {
  background-color: var(--matrix-sticky-bg-hover) !important;
}

/* FIXED: Ensure scrollable columns have proper borders (but not sticky columns) */
.matrix-control-root .fui-Table .fui-TableHeaderCell:not(:first-child):not(:nth-child(2)),
.matrix-control-root .fui-Table .fui-TableCell:not(:first-child):not(:nth-child(2)) {
  border-right: 1px solid var(--matrix-border-color) !important;
  border-bottom: 1px solid var(--matrix-border-color) !important;
}

/* ===== END CRITICAL FIXES ===== */

/* Focus management for accessibility */
.matrix-control-root *:focus {
  outline: 2px solid #0078d4;
  outline-offset: 2px;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .matrix-control-root {
    border: 2px solid ButtonText;
  }
  
  .matrix-table-cell {
    border: 1px solid ButtonText;
  }
  
  /* Enhanced high contrast for sticky columns */
  :root {
    --matrix-sticky-bg: Window;
    --matrix-sticky-bg-hover: Highlight;
    --matrix-header-bg: ButtonFace;
    --matrix-border-color: ButtonText;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .matrix-control-root * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* Mobile responsiveness with updated custom properties */
@media (max-width: 768px) {
  :root {
    --matrix-first-column-width: 150px;
    --matrix-bulk-column-width: 50px;
    --matrix-checkbox-column-width: 100px;
  }
  
  .matrix-control-root {
    font-size: 14px;
  }
  
  .matrix-table-cell {
    min-width: 80px;
    padding: 4px;
  }
}

@media (max-width: 480px) {
  :root {
    --matrix-first-column-width: 120px;
    --matrix-bulk-column-width: 40px;
    --matrix-checkbox-column-width: 80px;
  }
}

/* Print styles */
@media print {
  .matrix-control-root {
    -webkit-print-color-adjust: exact;
    color-adjust: exact;
  }
  
  .action-bar {
    display: none;
  }
  
  /* Remove sticky positioning for print */
  .matrix-control-root .fui-Table .fui-TableHeaderCell,
  .matrix-control-root .fui-Table .fui-TableCell {
    position: static !important;
    background-color: white !important;
    box-shadow: none !important;
    backdrop-filter: none !important;
  }
}

/* Loading animation for better UX */
@keyframes matrix-pulse {
  0% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
  100% {
    opacity: 1;
  }
}

.matrix-loading {
  animation: matrix-pulse 1.5s ease-in-out infinite;
}

/* Error state styling */
.matrix-error {
  border: 2px solid #d13438;
  border-radius: 4px;
  background-color: #fdf2f2;
}

/* Success state styling */
.matrix-success {
  border: 2px solid #0e7c0e;
  border-radius: 4px;
  background-color: #f1fdf1;
}

/* ===== YOUR EXISTING ENHANCEMENTS (PRESERVED AND ENHANCED) ===== */

/* Status-based column header styles */
.matrix-control-root .column-header-draft {
  background-color: #f5f5f5;
}

.matrix-control-root .column-header-ready {
  background-color: #c3f6cb !important;
  transition: background-color 0.2s ease;
}

.matrix-control-root .column-header-ready:hover {
  background-color: #8ff39e !important;
}

.matrix-control-root .column-header-approved {
  background-color: #f0eeff !important;
  transition: background-color 0.2s ease;
}

.matrix-control-root .column-header-approved:hover {
  background-color: rgb(169, 153, 234) !important;
}

.matrix-control-root .column-header-rework {
  background-color: #ebf7cb !important;
  transition: background-color 0.2s ease;
}

.matrix-control-root .column-header-rework:hover {
  background-color: #e1fb9a !important;
}

.matrix-control-root .column-header-disabled {
  background-color: #f5f5f5;
  opacity: 0.7;
  cursor: not-allowed !important;
}

/* ENHANCED: Bulk selection column improvements with fixed positioning */
.matrix-control-root .bulk-selection-column {
  min-width: var(--matrix-bulk-column-width) !important;
  width: var(--matrix-bulk-column-width) !important;
  background-color: var(--matrix-sticky-bg) !important;
  /* REMOVED: unwanted border-right */
}

.matrix-control-root .bulk-selection-column.sticky-header {
  position: -webkit-sticky !important;
  position: sticky !important;
  left: var(--matrix-first-column-width) !important;
  top: 0 !important;
  z-index: 15 !important;
  background-color: var(--matrix-header-bg) !important;
  backdrop-filter: blur(8px) !important;
  -webkit-backdrop-filter: blur(8px) !important;
}

.matrix-control-root .bulk-selection-column.sticky-row-header {
  position: -webkit-sticky !important;
  position: sticky !important;
  left: var(--matrix-first-column-width) !important;
  z-index: 10 !important;
  background-color: var(--matrix-sticky-bg) !important;
  backdrop-filter: blur(8px) !important;
  -webkit-backdrop-filter: blur(8px) !important;
}

.matrix-control-root .bulk-selection-info-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: help;
  color: #666;
  transition: color 0.2s ease;
}

.matrix-control-root .bulk-selection-info-icon:hover {
  color: #0078d4;
}

/* Enhanced assignment checkbox states */
.matrix-control-root .assignment-checkbox-non-interactable {
  opacity: 0.6 !important;
  cursor: not-allowed !important;
  pointer-events: none;
}

.matrix-control-root .assignment-checkbox-non-interactable input[type="checkbox"] {
  cursor: not-allowed !important;
  background-color: #f0f0f0 !important;
  border-color: #ccc !important;
}

.matrix-control-root .assignment-checkbox-conflict {
  border: 2px solid #d13438 !important;
  border-radius: 4px;
  padding: 2px;
  animation: matrix-pulse 2s ease-in-out infinite;
}

.matrix-control-root .assignment-checkbox-pending {
  border: 2px solid #0078d4 !important;
  border-radius: 4px;
  padding: 2px;
  position: relative;
}

.matrix-control-root .assignment-checkbox-pending::after {
  content: '';
  position: absolute;
  top: -2px;
  right: -2px;
  width: 6px;
  height: 6px;
  background-color: #0078d4;
  border-radius: 50%;
}

/* Bulk selection summary */
.matrix-control-root .bulk-selection-summary {
  padding: 8px 16px;
  background-color: #f0f0f0;
  border-radius: 4px;
  margin-bottom: 8px;
  font-size: 14px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border: 1px solid #ccc;
}

.matrix-control-root .bulk-selection-actions {
  display: flex;
  gap: 8px;
}

/* Enhanced performance stats */
.matrix-control-root .performance-stats-enhanced {
  font-size: 12px;
  color: #666;
  text-align: center;
  padding: 8px;
  background-color: #f5f5f5;
  border-radius: 4px;
  border: 1px solid #ccc;
  margin-top: 8px;
}

.matrix-control-root .performance-stats-enhanced .version-info {
  font-weight: 600;
  color: #0078d4;
}

/* Enhanced debug actions */
.matrix-control-root .debug-actions-enhanced {
  display: flex;
  gap: 8px;
  justify-content: center;
  margin-bottom: 16px;
  padding: 8px;
  background-color: #f0f0f0;
  border-radius: 4px;
  border: 1px solid #ccc;
}

.matrix-control-root .debug-actions-enhanced button {
  font-size: 12px;
  padding: 4px 8px;
}

/* Loading state for version chain processing */
.matrix-control-root .version-chain-processing {
  animation: matrix-pulse 1.5s ease-in-out infinite;
  opacity: 0.7;
}

/* Success state for bulk operations */
.matrix-control-root .bulk-operation-success {
  border: 2px solid #0e7c0e;
  border-radius: 4px;
  background-color: #f1fdf1;
  padding: 8px;
  margin-bottom: 8px;
  font-size: 14px;
}

/* Error state for version chain issues */
.matrix-control-root .version-chain-error {
  border: 2px solid #d13438;
  border-radius: 4px;
  background-color: #fdf2f2;
  padding: 8px;
  margin-bottom: 8px;
  font-size: 14px;
}

/* Enhanced focus management */
.matrix-control-root .bulk-selection-column *:focus,
.matrix-control-root .bulk-selection-info-icon:focus {
  outline: 2px solid #0078d4;
  outline-offset: 2px;
}

.matrix-control-root .assignment-checkbox-non-interactable:focus {
  outline: 2px solid #ccc;
  outline-offset: 2px;
}

/* Smooth scrolling for better UX when bulk selecting */
.matrix-control-root .smooth-scroll {
  scroll-behavior: smooth;
}

/* Visual feedback for drag-and-drop future enhancement */
.matrix-control-root .bulk-selection-draggable {
  cursor: grab;
}

.matrix-control-root .bulk-selection-dragging {
  cursor: grabbing;
  opacity: 0.7;
}

/* ===== BROWSER-SPECIFIC FIXES ===== */

/* Safari specific fixes for sticky positioning */
@supports (-webkit-appearance: none) {
  .matrix-control-root .fui-Table .fui-TableHeaderCell:first-child,
  .matrix-control-root .fui-Table .fui-TableCell:first-child,
  .matrix-control-root .fui-Table .fui-TableHeaderCell:nth-child(2),
  .matrix-control-root .fui-Table .fui-TableCell:nth-child(2) {
    -webkit-transform: translateZ(0) !important;
    transform: translateZ(0) !important;
  }
}

/* Firefox specific fixes */
@-moz-document url-prefix() {
  .matrix-control-root .fui-Table {
    border-collapse: separate !important;
  }
}

/* Performance optimization */
.matrix-control-root .fui-Table .fui-TableHeaderCell,
.matrix-control-root .fui-Table .fui-TableCell {
  contain: layout style paint;
  will-change: transform;
}

/* ===== ENHANCED MEDIA QUERIES ===== */

/* Enhanced high contrast mode support */
@media (prefers-contrast: high) {
  .matrix-control-root .column-header-ready {
    background-color: #e6e0ff !important;
    border: 2px solid #6b46c1 !important;
  }
  
  .matrix-control-root .column-header-approved {
    background-color: #ddd6fe !important;
    border: 2px solid #7c3aed !important;
  }
  
  .matrix-control-root .assignment-checkbox-non-interactable {
    opacity: 0.8 !important;
    border: 2px solid ButtonText !important;
  }
  
  .matrix-control-root .bulk-selection-info-icon {
    color: ButtonText;
  }
  
  .matrix-control-root .bulk-selection-info-icon:hover {
    color: Highlight;
  }
}

/* Enhanced reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .matrix-control-root .column-header-ready,
  .matrix-control-root .column-header-approved,
  .matrix-control-root .bulk-selection-info-icon {
    transition: none !important;
  }
  
  .matrix-control-root .assignment-checkbox-conflict {
    animation: none !important;
  }
}

/* Enhanced mobile responsiveness */
@media (max-width: 768px) {
  .matrix-control-root .bulk-selection-column {
    min-width: 50px;
    width: 50px;
  }
  
  .matrix-control-root .bulk-selection-summary {
    flex-direction: column;
    gap: 8px;
    align-items: flex-start;
    font-size: 12px;
  }
  
  .matrix-control-root .bulk-selection-actions {
    width: 100%;
    justify-content: flex-end;
  }
  
  .matrix-control-root .performance-stats-enhanced {
    font-size: 10px;
  }
  
  .matrix-control-root .debug-actions-enhanced {
    flex-wrap: wrap;
    gap: 4px;
  }
  
  .matrix-control-root .debug-actions-enhanced button {
    font-size: 10px;
    padding: 2px 6px;
  }
}

/* Enhanced print styles */
@media print {
  .matrix-control-root .debug-actions-enhanced,
  .matrix-control-root .bulk-selection-summary,
  .matrix-control-root .bulk-selection-column,
  .matrix-control-root .performance-stats-enhanced {
    display: none !important;
  }
  
  .matrix-control-root .column-header-ready,
  .matrix-control-root .column-header-approved {
    background-color: #f0f0f0 !important;
    -webkit-print-color-adjust: exact;
    color-adjust: exact;
  }
  
  .matrix-control-root .assignment-checkbox-conflict,
  .matrix-control-root .assignment-checkbox-pending {
    border: 1px solid #000 !important;
  }
}
/* CRITICAL: Force sticky positioning for first column header */
.matrix-control-root .fui-Table .fui-TableHeaderCell:first-child {
  position: -webkit-sticky !important;
  position: sticky !important;
  left: 0 !important;
  top: 0 !important;
  z-index: 1000 !important;
  background-color: var(--matrix-header-bg) !important;
  
  /* Prevent transparency bleeding */
  backdrop-filter: blur(8px) !important;
  -webkit-backdrop-filter: blur(8px) !important;
  
  /* Create solid background layer */
  box-shadow: 
    2px 0 4px rgba(0, 0, 0, 0.1),
    inset 0 0 0 1000px var(--matrix-header-bg) !important;
  
  /* Force new stacking context */
  isolation: isolate !important;
  
  /* Ensure content doesn't wrap */
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
  
  /* Browser compatibility */
  -webkit-transform: translateZ(0) !important;
  transform: translateZ(0) !important;
}

/* CRITICAL: Also fix for table body cells */
.matrix-control-root .fui-Table .fui-TableCell:first-child {
  position: -webkit-sticky !important;
  position: sticky !important;
  left: 0 !important;
  z-index: 999 !important;
  background-color: var(--matrix-sticky-bg) !important;
  
  /* Prevent transparency bleeding */
  backdrop-filter: blur(8px) !important;
  -webkit-backdrop-filter: blur(8px) !important;
  
  /* Create solid background layer */
  box-shadow: 
    2px 0 4px rgba(0, 0, 0, 0.1),
    inset 0 0 0 1000px var(--matrix-sticky-bg) !important;
  
  /* Force new stacking context */
  isolation: isolate !important;
  
  /* Browser compatibility */
  -webkit-transform: translateZ(0) !important;
  transform: translateZ(0) !important;
}